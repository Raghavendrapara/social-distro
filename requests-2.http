### Global Variables
@host = http://localhost:8080
@contentType = application/json

# ==========================================
# 1. Health Check (Verify App is UP)
# ==========================================
GET {{host}}/actuator/health
Accept: {{contentType}}

###

# ==========================================
# 2. Create a New Pod (Knowledge Base)
# ==========================================
# @name createPod
POST {{host}}/pods
Content-Type: {{contentType}}

{
  "name": "Social Distro V2 - 2026 Edition",
  "ownerUserId": "raghav-god-tier-v5"
}

> {%
    client.global.set("podId", response.body.podId);
    client.log("‚úÖ Created Pod ID: " + response.body.podId);
%}

###

# ==========================================
# 3. Add Data Item (Context for RAG)
# ==========================================
POST {{host}}/pods/{{podId}}/data
Content-Type: {{contentType}}

{
  "content": "Raghav is a software Engineer. The social-distro app uses Kafka for async indexing and Resilience4j for fault tolerance. It runs on Docker with Postgres pgvector."
}

###

# ==========================================
# 4. Start Indexing (Triggers Kafka -> Worker -> Ollama)
# ==========================================
# @name startIndexing
POST {{host}}/indexing/pods/{{podId}}
Content-Type: {{contentType}}

> {%
    client.global.set("jobId", response.body.jobId);
    client.log("üöÄ Started Job ID: " + response.body.jobId);
%}

###

# ==========================================
# 5. Check Job Status (Poll this until status = COMPLETED)
# ==========================================
GET {{host}}/indexing/jobs/{{jobId}}
Accept: {{contentType}}

> {%
    client.log("Current Job Status: " + response.body.status);
    if (response.body.status === "FAILED") {
        client.log("‚ùå Job Failed: " + response.body.errorMessage);
    }
%}

###

# ==========================================
# 6. Query the Pod (The Final Test)
# ==========================================
# Only run this after Step 5 shows "COMPLETED"
POST {{host}}/pods/{{podId}}/query
Content-Type: {{contentType}}

{
  "question": "What technology handles fault tolerance in this app?"
}